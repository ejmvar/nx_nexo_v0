# ==============================================================================
# PRODUCTION-LIKE Environment Configuration
# ==============================================================================
# This file is for LOCAL PRODUCTION SIMULATION in Docker containers (ports 7xxx).
# Copy this file to .env.prod and adjust values with REAL, STRONG secrets.
#
# ⚠️⚠️⚠️ CRITICAL SECURITY WARNING ⚠️⚠️⚠️
# This configuration is for LOCAL SIMULATION ONLY.
# For REAL PRODUCTION deployment, use Kubernetes/ECS/similar orchestration
# with proper secret management (Vault, AWS Secrets Manager, etc.).
#
# DO NOT use default passwords. Generate strong, random secrets:
#   openssl rand -base64 32
# ==============================================================================

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# ----------------------------------------------------------------------------
POSTGRES_DB=nexo_prod
POSTGRES_USER=nexo_user
POSTGRES_PASSWORD=CHANGE-THIS-USE-VAULT-OR-SECRETS-MANAGER  # ⚠️⚠️⚠️ CRITICAL

# PostgreSQL Connection URL (used by backend services)
DATABASE_URL=postgresql://nexo_user:CHANGE-THIS-USE-VAULT-OR-SECRETS-MANAGER@nexo-postgres-prod:5432/nexo_prod

# PostgreSQL SSL Configuration
PGSSLMODE=prefer  # prefer, require, verify-ca, verify-full
# PGSSLROOTCERT=/path/to/root.crt
# PGSSLCERT=/path/to/client-cert.pem
# PGSSLKEY=/path/to/client-key.pem

# ----------------------------------------------------------------------------
# Redis Configuration
# ----------------------------------------------------------------------------
REDIS_HOST=nexo-redis-prod
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE-THIS-USE-VAULT-OR-SECRETS-MANAGER  # ⚠️⚠️⚠️ CRITICAL

# Redis TLS (if using)
# REDIS_TLS_ENABLED=true
# REDIS_TLS_CA=/path/to/ca.crt

# ----------------------------------------------------------------------------
# JWT Configuration
# ----------------------------------------------------------------------------
# ⚠️ Generate strong secret: openssl rand -base64 64
JWT_SECRET=CHANGE-THIS-USE-64-CHAR-RANDOM-SECRET-FROM-VAULT  # ⚠️⚠️⚠️ CRITICAL
JWT_EXPIRES_IN=15m   # Short expiry for production (15 minutes)
JWT_REFRESH_EXPIRES_IN=7d

# JWT Algorithm (recommended: RS256 with public/private keys)
JWT_ALGORITHM=HS256  # or RS256, ES256
# JWT_PUBLIC_KEY_PATH=/secrets/jwt-public.pem
# JWT_PRIVATE_KEY_PATH=/secrets/jwt-private.pem

# ----------------------------------------------------------------------------
# Service URLs (Internal Docker Network)
# ----------------------------------------------------------------------------
AUTH_SERVICE_URL=http://nexo-auth-service-prod:3001
CRM_SERVICE_URL=http://nexo-crm-service-prod:3003
API_GATEWAY_URL=http://nexo-api-gateway-prod:3002

# Frontend Public API URL (External Access)
# For real production: https://api.nexo.example.com
NEXT_PUBLIC_API_URL=http://localhost:7002

# ----------------------------------------------------------------------------
# Environment Settings
# ----------------------------------------------------------------------------
NODE_ENV=production  # Production mode
LOG_LEVEL=warn       # Minimal logging (errors and warnings only)

# ----------------------------------------------------------------------------
# Monitoring & Observability (REQUIRED)
# ----------------------------------------------------------------------------
ENABLE_METRICS=true
ENABLE_TRACING=true

# Sentry (Error Tracking)
SENTRY_DSN=https://your-real-sentry-dsn@sentry.io/project  # ⚠️ CHANGE THIS
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1  # 10% of transactions
SENTRY_RELEASE=  # Set via CI/CD

# APM (Application Performance Monitoring)
NEW_RELIC_LICENSE_KEY=  # ⚠️ CHANGE THIS
NEW_RELIC_APP_NAME=nexo-production
DATADOG_API_KEY=  # or use Datadog
DATADOG_APP_KEY=

# Prometheus Metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# ----------------------------------------------------------------------------
# File Storage Configuration
# ----------------------------------------------------------------------------
# ⚠️ For production, use S3/Azure/GCP, NOT local filesystem
FILE_STORAGE_TYPE=s3  # s3, azure, gcp, minio
FILE_STORAGE_NAME=nexo-prod-storage
FILE_STORAGE_ID=nexo-prod-bucket  # S3 bucket name

# AWS S3 Configuration
AWS_ACCESS_KEY_ID=  # ⚠️ Use IAM roles instead if possible
AWS_SECRET_ACCESS_KEY=  # ⚠️ Use AWS Secrets Manager
AWS_REGION=us-east-1
S3_BUCKET_NAME=nexo-prod-uploads
S3_ENDPOINT=  # For MinIO or custom S3

# CloudFront CDN (if using)
CLOUDFRONT_DISTRIBUTION_ID=
CLOUDFRONT_DOMAIN=cdn.nexo.example.com

# Azure Blob Storage (alternative)
# AZURE_STORAGE_ACCOUNT=
# AZURE_STORAGE_KEY=
# AZURE_CONTAINER_NAME=

# GCP Cloud Storage (alternative)
# GCP_PROJECT_ID=
# GCP_BUCKET_NAME=
# GCP_SERVICE_ACCOUNT_KEY=/secrets/gcp-key.json

# ----------------------------------------------------------------------------
# Rate Limiting (REQUIRED)
# ----------------------------------------------------------------------------
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX=100       # Requests per window per IP
RATE_LIMIT_WINDOW=60000  # 1 minute
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false

# DDoS Protection
RATE_LIMIT_STRICT_MODE=true
RATE_LIMIT_WHITELIST=  # Comma-separated IPs

# ----------------------------------------------------------------------------
# CORS Configuration
# ----------------------------------------------------------------------------
# ⚠️ Set to your REAL production domain
CORS_ORIGIN=https://nexo.example.com,https://app.nexo.example.com
CORS_CREDENTIALS=true
CORS_MAX_AGE=86400  # 24 hours

# ----------------------------------------------------------------------------
# Email Configuration (REQUIRED for password resets, notifications)
# ----------------------------------------------------------------------------
SMTP_HOST=smtp.sendgrid.net  # or smtp.mailgun.org, etc.
SMTP_PORT=587
SMTP_USER=apikey  # SendGrid uses "apikey" as username
SMTP_PASSWORD=  # ⚠️ Use SendGrid API Key via Secrets Manager
SMTP_FROM=noreply@nexo.example.com
SMTP_TLS=true

# Email Templates
EMAIL_WELCOME_TEMPLATE=welcome.html
EMAIL_PASSWORD_RESET_TEMPLATE=password-reset.html

# ----------------------------------------------------------------------------
# Backup Configuration (CRITICAL)
# ----------------------------------------------------------------------------
BACKUP_ENABLED=true
BACKUP_PATH=/backups
BACKUP_S3_BUCKET=nexo-prod-backups  # Store backups in S3
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM UTC
BACKUP_RETENTION_DAYS=90   # Keep 90 days
BACKUP_ENCRYPTION_KEY=  # ⚠️ Encrypt backups

# Database Backup
DB_BACKUP_ENABLED=true
DB_BACKUP_SCHEDULE=0 */6 * * *  # Every 6 hours
DB_BACKUP_RETENTION=30  # Keep 30 backups

# ----------------------------------------------------------------------------
# Security Headers (REQUIRED)
# ----------------------------------------------------------------------------
HELMET_ENABLED=true
HSTS_MAX_AGE=31536000  # 1 year
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# Content Security Policy
CSP_DIRECTIVES=default-src 'self'; script-src 'self' 'unsafe-inline'; img-src 'self' data: https:

# ----------------------------------------------------------------------------
# SSL/TLS Configuration
# ----------------------------------------------------------------------------
# For real production, use Let's Encrypt or commercial certificate
SSL_CERT_PATH=/etc/ssl/certs/nexo.crt
SSL_KEY_PATH=/etc/ssl/private/nexo.key
SSL_CA_PATH=/etc/ssl/certs/ca-bundle.crt

# Force HTTPS
FORCE_HTTPS=true
TRUST_PROXY=true  # If behind load balancer/CDN

# ----------------------------------------------------------------------------
# Session Configuration
# ----------------------------------------------------------------------------
SESSION_SECRET=  # ⚠️ Generate strong secret
SESSION_MAX_AGE=86400000  # 24 hours
SESSION_SECURE=true  # HTTPS only
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# ----------------------------------------------------------------------------
# Authentication & Authorization
# ----------------------------------------------------------------------------
# Password Policy
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=true

# Account Security
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900000  # 15 minutes
REQUIRE_EMAIL_VERIFICATION=true
REQUIRE_MFA=false  # Multi-factor auth (optional)

# ----------------------------------------------------------------------------
# Logging & Audit
# ----------------------------------------------------------------------------
# Log to external system (CloudWatch, ELK, etc.)
LOG_FORMAT=json
LOG_DESTINATION=stdout  # or /var/log/nexo.log
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=365

# External Logging
# CLOUDWATCH_LOG_GROUP=/aws/ecs/nexo-prod
# ELK_ENDPOINT=https://elk.example.com:9200

# ----------------------------------------------------------------------------
# Performance Optimization
# ----------------------------------------------------------------------------
# Enable caching
CACHE_ENABLED=true
CACHE_TTL=3600  # 1 hour

# CDN Configuration
CDN_ENABLED=true
CDN_URL=https://cdn.nexo.example.com

# Database Connection Pooling
DB_POOL_MIN=10
DB_POOL_MAX=50
DB_POOL_IDLE_TIMEOUT=10000

# ----------------------------------------------------------------------------
# Feature Flags
# ----------------------------------------------------------------------------
FEATURE_FLAGS_ENABLED=true
FEATURE_DATA_IMPORT=false
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_AI_ASSISTANT=false

# ----------------------------------------------------------------------------
# Third-Party Integrations
# ----------------------------------------------------------------------------
# Payment Gateway (if using)
# STRIPE_SECRET_KEY=
# STRIPE_PUBLISHABLE_KEY=
# STRIPE_WEBHOOK_SECRET=

# Analytics (Google Analytics, Mixpanel, etc.)
# GA_TRACKING_ID=
# MIXPANEL_TOKEN=

# ----------------------------------------------------------------------------
# Health Checks & Monitoring
# ----------------------------------------------------------------------------
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
READINESS_CHECK_PATH=/ready
LIVENESS_CHECK_PATH=/alive

# ----------------------------------------------------------------------------
# Compliance & Privacy
# ----------------------------------------------------------------------------
GDPR_ENABLED=true
PRIVACY_POLICY_URL=https://nexo.example.com/privacy
TERMS_OF_SERVICE_URL=https://nexo.example.com/terms
DATA_RETENTION_DAYS=2555  # 7 years

# ----------------------------------------------------------------------------
# Maintenance Mode
# ----------------------------------------------------------------------------
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System under maintenance. We'll be back soon."

# ==============================================================================
# REMINDER: This is for LOCAL SIMULATION only!
# For REAL PRODUCTION:
# - Use Kubernetes/ECS/Cloud Run
# - Use secret management (Vault, AWS Secrets Manager, GCP Secret Manager)
# - Use managed databases (RDS, Cloud SQL, Azure Database)
# - Use managed Redis (ElastiCache, Cloud Memorystore)
# - Use CDN (CloudFront, CloudFlare, Fastly)
# - Use load balancers (ALB, NLB, Cloud Load Balancing)
# - Implement auto-scaling
# - Set up monitoring and alerting
# - Enable automated backups
# - Implement disaster recovery
# ==============================================================================
