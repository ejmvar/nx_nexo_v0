# Production environment values
# High availability with full resources

global:
  environment: production
  domain: nexo.com
  imagePullPolicy: Always

postgresql:
  replicaCount: 3
  persistence:
    enabled: true
    size: 100Gi
    storageClass: "ssd-retain"
  env:
    password: "CHANGE_ME_IN_SECRETS"
  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"
  backup:
    enabled: true
    schedule: "0 2 * * *"
    retention: 30

redis:
  replicaCount: 3
  persistence:
    enabled: true
    size: 50Gi
    storageClass: "ssd-retain"
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

keycloak:
  replicaCount: 3
  env:
    adminPassword: "CHANGE_ME_IN_SECRETS"
  resources:
    requests:
      memory: "2Gi"
      cpu: "1000m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

backend:
  replicaCount: 5
  image:
    tag: "v1.0.0"
  env:
    nodeEnv: production
    logLevel: warn
  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 70
  resources:
    requests:
      memory: "1Gi"
      cpu: "1000m"
    limits:
      memory: "2Gi"
      cpu: "2000m"
  podDisruptionBudget:
    enabled: true
    minAvailable: 3

frontend:
  replicaCount: 3
  image:
    tag: "v1.0.0"
  service:
    type: ClusterIP
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 60
  resources:
    requests:
      memory: "1Gi"
      cpu: "1000m"
    limits:
      memory: "2Gi"
      cpu: "2000m"
  podDisruptionBudget:
    enabled: true
    minAvailable: 2

prometheus:
  replicaCount: 2
  persistence:
    enabled: true
    size: 100Gi
    storageClass: "ssd-retain"
  resources:
    requests:
      memory: "4Gi"
      cpu: "2000m"
    limits:
      memory: "8Gi"
      cpu: "4000m"
  retention: 90d

grafana:
  replicaCount: 2
  persistence:
    enabled: true
    size: 20Gi
    storageClass: "ssd-retain"
  env:
    adminPassword: "CHANGE_ME_IN_SECRETS"
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/rate-limit: "1000"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - host: nexo.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
    - host: api.nexo.com
      paths:
        - path: /
          pathType: Prefix
          service: backend
  tls:
    - secretName: nexo-prod-tls
      hosts:
        - nexo.com
        - api.nexo.com

# Production security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Production node affinity (prefer different nodes for HA)
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - nexo-crm
          topologyKey: kubernetes.io/hostname
